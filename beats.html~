<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100%; }
  body { height: 100%; margin: 0; padding: 0; }
  #map_canvas {
  	height: 100%;
  }
</style>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script>
 // <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>

<script type="text/javascript">

// Variables

var initialLocation;
var initialMarker;
var title = document.createElement("DIV");
//var infowindow = new google.maps.InfoWindow({ maxWidth: 650 });  
//var infowindow = new google.maps.InfoWindow({ content: content });

// Initialize map
function initialize() {

	// Map settings
	var mapOptions = {
		center: new google.maps.LatLng(41.881944, -87.627778),
		zoom: 10,
		disableDefaultUI: true,
		zoomControl: true,
		zoomControlOptions: {
			position: google.maps.ControlPosition.RIGHT_CENTER
		},
	};
  
	// Geolocate - Show current location and beat
	if (navigator.geolocation) {
		navigator.geolocation.getCurrentPosition(function(position) {
			initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
			initialMarker = new google.maps.Marker({
				position: initialLocation,
				map: map,
				title: "You're here!"
			});
			map.setCenter(initialLocation);
			map.setZoom(15);
		})
	}
	var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

  
  	// Setting Stations Polygons using SQL-like syntax courtesy of the Google FT API
    var station = new google.maps.FusionTablesLayer({
    query: {
      select: '\'Geocodable address\'',
      from: '1nPvKEAywuuGnTfUYuAQ5YsUsjxd9VvATtqobYzbO',
    },
    styles: [{
      markerOptions: {
      iconName: "police_badge"
       }
    }]
    });  
  
	// Setting Beat Polygons using SQL-like syntax courtesy of the Google FT API
    var layer = new google.maps.FusionTablesLayer({
    query: {
      select: 'Geometry',
      from: '1_H6ZzONKTBlKXNquzT9agzzm5dCVIHQRctbEUGK2',
      where: 'District >=1 AND District <= 25'
    },
    /*
    styles: [{
      polygonOptions: {
      fillColor: "#0066CC",
      fillOpacity: 0.3,
      strokeColor: "#474747",
      strokeWeight: "2",
      strokeOpacity: 0.5
      }
     }]
     */
     options: {
     styleId: 2,
     templateId: 2
     }  
    });  
  
    layer.setMap(map);
    station.setMap(map);
    
    google.maps.event.addListener(station, 'click', function(e) {
    // Change the content of the InfoWindow
    e.infoWindowHtml = 
      '<div id ="content" style="overflow:hidden">' +
      "<h2><b>District " + e.row['DISTRICT'].value + "</b></h2></p>" +
      "<p>" + e.row['ADDRESS'].value + "<br />" +
      e.row['CITY'].value + ", " + e.row['STATE'].value + " " + e.row['ZIP'].value +
      '<p><a href="' + e.row['WEBSITE'].value + '">District Website</a>'
      '</div>';
    });
  
    google.maps.event.addListener(layer, 'click', function(e) {
    // Change the content of the InfoWindow
    e.infoWindowHtml =
    '<div id ="content" style="overflow:hidden">' +
      "<h2><b>Beat " + e.row['Beat Number'].value + "</b></h2></p>" +
      "<p><b>District: </b>" + e.row['District'].value + "<br />" +
      "<b>Sector: </b>" + e.row['Sector'].value + "<br />" +
      "<b>Beat: </b>" + e.row['Beat'].value + "<br /></p>"
      '</div>';
    });
  
  
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>
<body onload="initialize()">
  <div id="map_canvas"></div>
<script type="text/javascript">
</script>
</body>
</html>
